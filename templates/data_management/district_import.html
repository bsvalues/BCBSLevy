{% extends 'base.html' %}

{% block title %}Import Tax Districts - Levy Calculation System{% endblock %}

{% block head %}
{{ super() }}
<style>
    .card-top-border-primary:before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #3DA5BD, #7CBFCC);
    }
    
    .card-top-border-success:before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #66A355, #78c265);
    }
    
    .card-top-border-warning:before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #F0C75C, #f5d78a);
    }
    
    .card-top-border-info:before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #36b9cc, #5dcfdf);
    }
    
    .hover-card {
        position: relative;
        transition: transform 0.3s, box-shadow 0.3s;
        border-radius: 16px; 
        overflow: hidden;
    }
    
    .hover-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 .5rem 1rem rgba(0,0,0,.15)!important;
    }
</style>
{% endblock %}

{% block content %}
<!-- Header Section with Gradient Background -->
<div class="app-header-bg py-4 mb-4 rounded-4 mx-3">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="display-5 fw-bold text-white mb-3">Import Tax Districts</h1>
                <p class="lead text-light opacity-90 mb-0">Import tax district information from levy export files</p>
            </div>
            <div class="col-lg-4 text-lg-end mt-4 mt-lg-0">
                <a href="{{ url_for('data_management.data_management_index') }}" class="btn btn-light rounded-pill px-4">
                    <i class="bi bi-arrow-left me-2"></i>Back to Data Management
                </a>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col-lg-8">
            <!-- Main Import Card -->
            <div class="card hover-card card-top-border-primary position-relative mb-4">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0"><i class="bi bi-building-add"></i> Import Tax District Data</h5>
                </div>
                <div class="card-body">
                    <p class="lead">Upload a levy export file to import tax district information.</p>
                    <p>This specialized import tool will extract tax district information from various levy export formats automatically.</p>
                    
                    <form action="{{ url_for('data_management.import_levy_districts') }}" method="post" enctype="multipart/form-data">
                        <div class="mb-4">
                            <label for="districtFile" class="form-label">Select Levy Export File</label>
                            <input class="form-control form-control-lg" type="file" id="districtFile" name="file" required>
                            <div class="form-text">Supported formats: TXT, XLS, XLSX, CSV, XML</div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="taxYear" class="form-label">Tax Year</label>
                            <select class="form-select" id="taxYear" name="year">
                                <option value="">Auto-detect from file</option>
                                {% for year in years %}
                                <option value="{{ year }}">{{ year }}</option>
                                {% endfor %}
                            </select>
                            <div class="form-text">Select a specific year or let the system auto-detect it from the file</div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="importNotes" class="form-label">Import Notes</label>
                            <textarea class="form-control" id="importNotes" name="notes" rows="2" placeholder="Optional notes about this district import"></textarea>
                        </div>
                        
                        <div class="form-check mb-4">
                            <input class="form-check-input" type="checkbox" id="createMissingCodes" name="create_missing_codes" checked>
                            <label class="form-check-label" for="createMissingCodes">
                                Automatically create tax codes for imported districts
                            </label>
                            <div class="form-text">When checked, the system will create tax codes for each imported district</div>
                        </div>
                        
                        <div class="form-check mb-4">
                            <input class="form-check-input" type="checkbox" id="dryRun" name="dry_run">
                            <label class="form-check-label" for="dryRun">
                                Preview import only (dry run)
                            </label>
                            <div class="form-text">Check this option to preview the import results without committing changes to the database</div>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="bi bi-upload me-2"></i> Import Tax Districts
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Sample Files Card -->
            <div class="card hover-card card-top-border-info position-relative mb-4">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0"><i class="bi bi-file-earmark-text"></i> Sample Files</h5>
                </div>
                <div class="card-body">
                    <p>Use these sample files to test the import functionality:</p>
                    
                    <div class="list-group mb-3">
                        {% if sample_files %}
                            {% for file in sample_files %}
                                <a href="{{ url_for('data_management.download_sample', filename=file.filename) }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                    <div>
                                        <i class="bi {{ file.icon_class }} me-2"></i>
                                        {{ file.display_name }}
                                        <span class="badge bg-secondary ms-2">{{ file.format }}</span>
                                    </div>
                                    <span class="badge bg-primary rounded-pill">
                                        <i class="bi bi-download"></i>
                                    </span>
                                </a>
                            {% endfor %}
                        {% else %}
                            <div class="list-group-item text-center text-muted py-3">
                                <i class="bi bi-inbox me-2"></i>No sample files available
                            </div>
                        {% endif %}
                    </div>
                    
                    <p class="mb-0 small text-muted">
                        <i class="bi bi-info-circle me-1"></i> Sample files contain demonstration data and can be used to test the import functionality
                    </p>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <!-- Quick Tips Card -->
            <div class="card hover-card card-top-border-success position-relative mb-4">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0"><i class="bi bi-lightbulb"></i> Quick Tips</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <h6><i class="bi bi-check-circle text-success me-2"></i>File Format Detection</h6>
                        <p class="small">The system automatically detects the file format and extracts district information accordingly.</p>
                    </div>
                    
                    <div class="mb-3">
                        <h6><i class="bi bi-check-circle text-success me-2"></i>Auto-Year Detection</h6>
                        <p class="small">Leave the Tax Year field blank to automatically detect the year from the file content.</p>
                    </div>
                    
                    <div class="mb-3">
                        <h6><i class="bi bi-check-circle text-success me-2"></i>Duplicate Handling</h6>
                        <p class="small">Existing districts with the same ID will be updated with the new information from the import file.</p>
                    </div>
                    
                    <div class="mb-3">
                        <h6><i class="bi bi-check-circle text-success me-2"></i>Tax Code Creation</h6>
                        <p class="small">Enable "Automatically create tax codes" to generate tax codes for each imported district.</p>
                    </div>
                    
                    <div>
                        <h6><i class="bi bi-check-circle text-success me-2"></i>Preview Mode</h6>
                        <p class="small">Use the "Preview import only" option to see what would be imported without making changes to the database.</p>
                    </div>
                </div>
            </div>
            
            <!-- Import History Card -->
            <div class="card hover-card card-top-border-warning position-relative mb-4">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0"><i class="bi bi-clock-history"></i> Recent District Imports</h5>
                </div>
                <div class="card-body p-0">
                    <div class="list-group">
                        {% if recent_imports %}
                            {% for import_log in recent_imports %}
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <i class="bi bi-building me-2"></i>
                                        District Import
                                        <small class="text-muted ms-2">{{ import_log.created_at.strftime('%Y-%m-%d') }}</small>
                                    </div>
                                    <span class="badge bg-primary rounded-pill">{{ import_log.record_count }}</span>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="list-group-item text-center text-muted py-3">
                                <i class="bi bi-inbox me-2"></i>No recent district imports
                            </div>
                        {% endif %}
                    </div>
                </div>
                <div class="card-footer bg-transparent">
                    <a href="{{ url_for('data_management.import_history') }}" class="btn btn-sm btn-outline-warning w-100">
                        <i class="bi bi-clock-history me-1"></i>View Import History
                    </a>
                </div>
            </div>
            
            <!-- Help Card -->
            <div class="card hover-card card-top-border-info position-relative mb-4">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0"><i class="bi bi-question-circle"></i> Help & Support</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-3">
                        <a href="{{ url_for('glossary.glossary_index') }}" class="btn btn-outline-info">
                            <i class="bi bi-book me-2"></i>Glossary
                        </a>
                        <a href="{{ url_for('help.documentation') }}" class="btn btn-outline-info">
                            <i class="bi bi-file-earmark-text me-2"></i>Documentation
                        </a>
                        <a href="{{ url_for('help.faq') }}" class="btn btn-outline-info">
                            <i class="bi bi-question-circle me-2"></i>FAQ
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    // Initialize any JavaScript functionality here
    document.addEventListener('DOMContentLoaded', function() {
        // Add any needed JavaScript for the district import page
    });
</script>
{% endblock %}
