{% extends "base.html" %}

{% block title %}Manage Roles - TerraLevy{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row mb-4">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h2 class="mb-0">Manage User Roles</h2>
        </div>
        <div class="card-body">
          <p class="lead">
            User roles control access to specialized dashboards and workflows within the TerraLevy platform. 
            Users can have multiple roles to support the multi-stage certification process.
          </p>
          
          {% if current_user.is_admin %}
          <div class="alert alert-info">
            <i class="bi bi-info-circle-fill me-2"></i>
            As an administrator, you can manage roles for all users.
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  
  {% if users %}
  <div class="row">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title mb-0">User Roles</h3>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>Username</th>
                  <th>Full Name</th>
                  <th>Roles</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for user in users %}
                <tr>
                  <td>{{ user.username }}</td>
                  <td>{{ user.full_name }}</td>
                  <td>
                    {% for role in user.roles %}
                      <span class="badge bg-primary me-1">{{ role.role }}</span>
                    {% else %}
                      <em class="text-muted">No roles assigned</em>
                    {% endfor %}
                  </td>
                  <td>
                    <div class="dropdown">
                      <button class="btn btn-sm btn-outline-primary dropdown-toggle" type="button" id="roleActions{{ user.id }}" data-bs-toggle="dropdown" aria-expanded="false">
                        Manage Roles
                      </button>
                      <ul class="dropdown-menu" aria-labelledby="roleActions{{ user.id }}">
                        <li><a class="dropdown-item" href="{{ url_for('auth.add_role', user_id=user.id, role='clerk') }}">
                          <i class="bi bi-plus-circle me-2"></i> Add Clerk Role
                        </a></li>
                        <li><a class="dropdown-item" href="{{ url_for('auth.add_role', user_id=user.id, role='deputy') }}">
                          <i class="bi bi-plus-circle me-2"></i> Add Deputy Role
                        </a></li>
                        <li><a class="dropdown-item" href="{{ url_for('auth.add_role', user_id=user.id, role='assessor') }}">
                          <i class="bi bi-plus-circle me-2"></i> Add Assessor Role
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{{ url_for('auth.remove_role', user_id=user.id, role='clerk') }}">
                          <i class="bi bi-dash-circle me-2"></i> Remove Clerk Role
                        </a></li>
                        <li><a class="dropdown-item" href="{{ url_for('auth.remove_role', user_id=user.id, role='deputy') }}">
                          <i class="bi bi-dash-circle me-2"></i> Remove Deputy Role
                        </a></li>
                        <li><a class="dropdown-item" href="{{ url_for('auth.remove_role', user_id=user.id, role='assessor') }}">
                          <i class="bi bi-dash-circle me-2"></i> Remove Assessor Role
                        </a></li>
                      </ul>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% else %}
  <div class="alert alert-warning">
    <i class="bi bi-exclamation-triangle-fill me-2"></i>
    No users found or you don't have permission to manage roles.
  </div>
  {% endif %}
  
  <div class="row mt-4">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title mb-0">Role Descriptions</h3>
        </div>
        <div class="card-body">
          <div class="row g-4">
            <div class="col-md-4">
              <div class="card h-100">
                <div class="card-header bg-light">
                  <h5 class="card-title mb-0">
                    <i class="bi bi-upload me-2 text-primary"></i> Clerk
                  </h5>
                </div>
                <div class="card-body">
                  <p>
                    <strong>Primary Responsibility:</strong> Data management and initial entry
                  </p>
                  <ul>
                    <li>Input and validate levy data</li>
                    <li>Import data from external sources</li>
                    <li>Run data quality checks</li>
                    <li>Prepare data for review</li>
                  </ul>
                </div>
              </div>
            </div>
            
            <div class="col-md-4">
              <div class="card h-100">
                <div class="card-header bg-light">
                  <h5 class="card-title mb-0">
                    <i class="bi bi-shield-check me-2 text-primary"></i> Deputy
                  </h5>
                </div>
                <div class="card-body">
                  <p>
                    <strong>Primary Responsibility:</strong> Review and analysis
                  </p>
                  <ul>
                    <li>Review clerk-prepared data</li>
                    <li>Verify statutory compliance</li>
                    <li>Analyze levy rate trends</li>
                    <li>Identify potential issues</li>
                  </ul>
                </div>
              </div>
            </div>
            
            <div class="col-md-4">
              <div class="card h-100">
                <div class="card-header bg-light">
                  <h5 class="card-title mb-0">
                    <i class="bi bi-check2-all me-2 text-primary"></i> Assessor
                  </h5>
                </div>
                <div class="card-body">
                  <p>
                    <strong>Primary Responsibility:</strong> Final approval and certification
                  </p>
                  <ul>
                    <li>Review deputy assessments</li>
                    <li>Provide final certification</li>
                    <li>Generate official reports</li>
                    <li>Manage public communication</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}